# machinelearning_2025_Fall_MAT3123  
2025-2학기 기계학습과 응용 과제 제출용입니다. 

# 원유 시장 미시구조 기반 엑슨 모빌 (XOM) 주가 예측 모델 

## 1. 프로젝트 개요 


 엑슨 모빌(이하 XOM)은 미국 시장의 오래된 시가총액 상위권에 속해있는 주식이며, 제가 오랜기간 보유해왔고 또 관심있게 지켜보는 주식이기에 선택하게되었습니다.
 
 더군다나 엑슨모빌은 사업구조상 경기에 민감하지않은 편이고 또한 타 S&P전체 보다 시장의 영향을 덜받습니다.
 
 시장이 급락할경우 베타 값이 급격히 튀지않는 주식, 또 배당 수익률 역시 연 3~4%로 통칭 "방어주" 로 유명합니다. 
 
 완벽히 독립적이라고 볼 수는 없지만 " 단기수익률의 관점에서는 원유 시장의 변동성 및 구조적인 요인에 더 민감하지않을까?" 라는 생각에 이에 대한 정밀한 분석을 해보고자 이 모델을 계획하였습니다.



 ## 2.  사용 모델 
XOM의 주가 수익률은 배당 수익률, 유가 스프레드, 변동성 지표(VIX, OVX), 기술적 지표(RSI, MACD) 등과 선형 관계를 가지지 않습니다.

LightGBM은 트리 기반 모델로서, 변수 간의 복잡한 비선형 상호작용을 별도 가정없이, 학습할 수 있어 데이터 구조에 적합하다고 생각됐습니다. 

또한 원유가격과 위험지수, MACD H등의 시차 변수를 동시에 입력하기때문에 이 부분에 용의하다고 생각되었습니다. 


 ## 3. 데이터 
데이터는 2015년부터 현재까지 10년치를 바탕으로 Yahoo finance에서 가져왔습니다.

원유의 거래는 대부분 선물시장에서 이뤄지기때문에, 브렌트유와 WTI유의 선물 가격을 차월물, 3월물,6월물,9월물,12월물을 전부 가져올 수 있었더라면 더 정량적인 분석을 할 수 있었겠지만  
Yahoo finance에서 CLZ, CLF ,CLM 등의 티커의 과거 가격을 얻을 수 없었습니다.

대신 원유의 시황을 추세로나마 따라가고자 차월물 ETF(USO)와 차년 평균 ETF(USL)로 Oil_curve_ratio를 계산하여 시장이 현재 백워데이션인지 콘탱고 상태인지를 변수에 넣었습니다. 

한편 주가분석의 특성상 전날 주가를 완벽히 추종해버리거나 하는 등의 과적합 현상이 발생할 수 있어 주가 데이터= target은 모델을 만드는 데에는 사용하지 않고 검증하는 곳에만 사용하였습니다. 

그외에 제가 사용한 지표들은 다음과 같습니다 RSI(상대강도지수), MACD 히스토그램, WTI-Brent_Spread(WTI 와 브렌트유의 가격차), Spread 변화량 , OVX,VIX 와 OVX /VIX 등을 사용하였습니다.

 ## 4. 모델 설명 및 결과 

 또한 모델의 성능을 안정적으로 향상시키기 위해 Optuna를 이용한 하이퍼파라미터 최적화를 수행하였습니다. lag feature가 많이 포함되어있기 때문에 하이퍼 파라미터를 고정값으로 설정할 경우 과적합의 위험이 있어 이를 방지하고자
 하이퍼 파라미터 최적화를 수행하였습니다. 단순히 성능 수치를 높이귀 위함이 아니라 모델의 일반화 능력과 해석가능성을 동시에 확보하기 위한 과정으로 활용되었습니다. 
 데이터의 시간순서를 유미하여 미래정보 누수를 방지하고, Early stoppiung을 적용하여 불필요한 학습 반복을 방지하였습니다.

 아래는 모델의 예측 결과 입니다. 

 <img width="1312" height="631" alt="image" src="https://github.com/user-attachments/assets/28bdeb0f-ca5b-46d5-9e1c-6aad29f92a34" />
중간 중간 튀는 결과들이 있지만 RMSE가 매우 준수하게나왔습니다. 경향성 역시 매우 잘 따라간 편이었습니다. 


 <img width="512" height="500" alt="image" src="https://github.com/user-attachments/assets/4ec08e7a-7c6a-49f9-afea-8ea5f0468c75" />

이 모델의 예측결과를 해석하기 위해 SHAP( SHapley Additive explanations)분석을 수행하였습니다. 
각 변수가 개별 예측값에 기여한 정도를 정량화 하는 기법으로, 단순한 중요도 순위 뿐 아니라 변수가 예측을 증가시키는 지 감소 시키는지 해석할 수 있었습니다.



### 4-1. OVX/VIX ratio 

     원유 시장의 변동성이 주식 시장의 변동성 대비 상대적으로 높은 국면에서 XOM이 단기적으로 유의미하게 변화하는 경향이 보였습니다. 
     이는 기존에 알고 있던 사실인 전체 주식시장보다 에너지 시장 고유의 리스크 요인에 더 민감하게 반응함을 시사합니다.
     
###  4-2. MACD histogram

     단기 모멘텀 상태를 나타내는 지표로 과거 며칠전의 모멘텀 변화가 다음날 수익률 예측에 중요한 영향을 미쳤습니다. 
     시장 참여자들이 "이 주식이 이 정도의 가격은 해야한다."라고 생각하는 부분이 반영된 것 같습니다.
     
### 4-3. RSI 

     과매수, 과매도 국면에서 향후 수익성을 포착하는 데에 역할을 하였습니다. 
     RSI가 낮은 구간에서는 추후 상승이 예상되었습니다. 
     
### 4-4 WTI-Brent spread

    유가 스프레드는 즉각적인 가격 변동보다 일정한 시차를 두고 수익률에 영향을 미치는 구조적인 변수로 작용하였습니다. 
    글로벌한 초 대형 정유 기업이고 정제 마진 혹은 지역별 가격구조가 기업의 수익성에 반영되기 때문으로 여겨집니다.

### 4-5 VIX, OVX 절댓값  

    시장과 원유의 절대적인 변동성 역시 예측에 기여하였지만 VIX 단독으로는 크게 영향을 주지 않았습니다.
    

 ## 5. 결론
 
 XOM의 단기적인 가격은 단순한 시장 지수의 움직임 보다 원유시장의 변동성 구조와 모멘텀 상태에 더 크게 의존한다는 점을 보여줍니다. 
 직관적으로 매일매일 미국주식 차트를 보면서 느꼈던 부분과 일치하는 결과를 얻었고 방어형 배당주로 알려져있던 사실과 유사하게 가격이 결정된다는 사실을 알 수 있었습니다. 

 ## 6. Further more 

아쉬운 점과 개선할 점

 1. 본 프로젝트를 진행하면서 모든 가격 및 변동성 데이터를 Yahoo finance에 의존하였습니다.

  앞서 데이터 설명에서도 기재하였지만 원유 선물의 정확한 기간구조 CL1-CL2, CLZ, CLM, CLH등의 과거 지표를 구할 수 없어 USO/USL ETF를 근사치로 사용하였습니다.
  ETF는 롤오버 비용과 보수등의 요인 또 추적오차를 포함하므로 실제 선물 커브와 괴리율이 존재할 수 밖에없습니다.

 2. 시장의 변동성과 기술적 지표등을 중심으로 구성하기만 하였습니다.
    
 금리 수준이라던지 OPEC의 정책, 감산 발표, 러시아-우크라이나 전쟁과 같은 큰 이벤트들의 요인을 고려하지 않았습니다.
 이런 요인들이 유가에도 반영되고 시장에도 반영되겠지만, 반영된 사실을 바탕으로 시장의 상황만을 판단한 모델이라 생각됩니다.
 따라서 특정이벤트의 경우 설명력이 떨어질 수 밖에 없는 모델이라 생각됩니다.
  
 3. 단기 예측에 한정된 구조
    
 1일 후 가격 예측에 초점을 맞추었으나,  유가 스프레드나, 배당, 투자 사이클들은 중기에 영향을 주는 지연효과가 있습니다. 
 이 부분을 고려하여 한달 후 혹은 몇 달 후 오를지 내릴 지를 판별하는 모델로 확장할 여지가 있습니다.



 

